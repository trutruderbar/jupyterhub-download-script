# =============================================================================
# Usage Monitoring Portal 環境變數配置範例
# =============================================================================
#
# 使用說明：
# 1. 複製此檔案為 .env: cp .env.example .env
# 2. 根據您的環境修改相關變數
# 3. 啟動服務: cd .. && ./start_usage_portal.sh
#

# =============================================================================
# FastAPI 服務設定
# =============================================================================

# FastAPI 綁定的主機位址
APP_HOST=0.0.0.0

# FastAPI 服務埠號
APP_PORT=29781

# PostgreSQL 資料庫連線 URL
# 格式: postgresql+psycopg2://username:password@host:port/database
DATABASE_URL=postgresql+psycopg2://usage_app:usage_app@localhost:5433/usage_db

# =============================================================================
# PostgreSQL 資料庫設定 (用於 docker-compose)
# =============================================================================

# PostgreSQL 使用者名稱
POSTGRES_USER=usage_app

# PostgreSQL 密碼
POSTGRES_PASSWORD=usage_app

# PostgreSQL 資料庫名稱
POSTGRES_DB=usage_db

# =============================================================================
# JupyterHub 整合設定
# =============================================================================

# Kubectl 指令 (MicroK8s 使用 "microk8s kubectl"，標準 K8s 使用 "kubectl")
KUBECTL_BIN="microk8s kubectl"

# JupyterHub 所在的 Kubernetes namespace
JHUB_NAMESPACE=jhub

# API 存取保護 Token (設定後所有 /api/* 端點需要 Authorization: Bearer <token>)
# 建議使用強隨機字串，例如: openssl rand -base64 32
DASHBOARD_TOKEN=

# =============================================================================
# 自動記錄器設定 (Auto Recorder)
# =============================================================================

# 啟用自動記錄器 (每隔一定時間掃描 K8s Pods 並記錄 Sessions)
AUTO_RECORD_ENABLED=true

# 自動記錄間隔 (秒)
AUTO_RECORD_INTERVAL=30

# =============================================================================
# PVC 清理器設定 (PVC Janitor)
# =============================================================================

# PVC 最大閒置天數 (超過此天數的閒置 PVC 會被自動清理)
PVC_MAX_AGE_DAYS=7

# PVC 清理器執行間隔 (秒)
PVC_JANITOR_INTERVAL_SECONDS=86400

# PVC 最後使用時間更新間隔 (秒)
PVC_LAST_USED_TOUCH_INTERVAL_SECONDS=3600

# =============================================================================
# MySQL 同步設定 (Pod Report Sync)
# =============================================================================

# 啟用 MySQL 同步 (將 PostgreSQL Sessions 同步到外部 MySQL)
POD_REPORT_SYNC_ENABLED=false

# MySQL 同步間隔 (秒)
POD_REPORT_SYNC_INTERVAL_SECONDS=1800

# MySQL 資料庫主機
POD_REPORT_SYNC_DB_HOST=your-mysql-host

# MySQL 資料庫埠號
POD_REPORT_SYNC_DB_PORT=3306

# MySQL 資料庫使用者
POD_REPORT_SYNC_DB_USER=your-mysql-user

# MySQL 資料庫密碼
POD_REPORT_SYNC_DB_PASSWORD=your-mysql-password

# MySQL 資料庫名稱
POD_REPORT_SYNC_DB_NAME=jupyterhub

# MySQL 目標資料表名稱
POD_REPORT_SYNC_TABLE=pod_report

# 要同步的 Kubernetes namespace
POD_REPORT_SYNC_NAMESPACE=jhub

# =============================================================================
# Portal 登入代理設定 (選用)
# =============================================================================

# 前端登入表單會將請求轉發到此 URL (若使用自訂 SSO)
# PORTAL_LOGIN_PROXY_TARGET=http://your-auth-api:8000/command

# =============================================================================
# 使用範例
# =============================================================================
#
# 1. 查詢使用者配額：
#    curl -X GET http://localhost:29781/users/username/limits \
#      -H "Authorization: Bearer your-token"
#
# 2. 更新使用者配額：
#    curl -X PATCH http://localhost:29781/users/username \
#      -H "Content-Type: application/json" \
#      -H "Authorization: Bearer your-token" \
#      -d '{"cpu_limit_cores":64,"memory_limit_gib":256,"gpu_limit":8}'
#
# 3. 查詢所有 Sessions：
#    curl -X GET http://localhost:29781/sessions \
#      -H "Authorization: Bearer your-token"
#
# 4. 結束特定 Session：
#    curl -X PUT http://localhost:29781/sessions/123/end \
#      -H "Authorization: Bearer your-token"
#
# =============================================================================
# 安全注意事項
# =============================================================================
#
# 1. 請使用強隨機 DASHBOARD_TOKEN，避免使用預設值
# 2. 生產環境建議使用 HTTPS
# 3. 定期備份 PostgreSQL 資料庫
# 4. 請勿將包含真實密碼的 .env 檔案提交至版控
#
# =============================================================================
