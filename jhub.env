# 全域安裝參數，可由所有腳本自動載入。
# 需要不同設定可以編輯本檔案或設定 JHUB_ENV_FILE 指向另一路徑。

export AUTH_MODE=<>
export UBILINK_AUTH_ME_URL="<>"
export UBILINK_LOGIN_URL="<>"
export ADMIN_USERS_CSV="<>"
export JHUB_NS="${JHUB_NS:-jhub}"

export ENABLE_NGINX_PROXY=true
export NGINX_PROXY_SERVER_NAME="<> <> $(hostname -f)"
export NGINX_PROXY_HTTPS_PORT=443
export NGINX_PROXY_CERT_FILE=/root/certs/jhub.crt
export NGINX_PROXY_KEY_FILE=/root/certs/jhub.key
export TLS_CERT_FILE="$NGINX_PROXY_CERT_FILE"
export TLS_KEY_FILE="$NGINX_PROXY_KEY_FILE"
export JHUB_FRAME_ANCESTORS="<> https://$(hostname -f) http://localhost:8080"
export ADMIN_USER="<>"
export JHUB_RELEASE="jhub"
export JHUB_CHART_VERSION="4.2.0"
export HELM_TIMEOUT="25m0s"
export NODEPORT_FALLBACK_PORT=30080
export PF_BIND_ADDR="0.0.0.0"
export PF_LOCAL_PORT=18080
export PF_AUTOSTART=true
# Notebook 映像與儲存配置
export SINGLEUSER_IMAGE="myorg3/pytorch-jhub:24.10"
export SINGLEUSER_IMAGE_PULL_POLICY="IfNotPresent"
export PVC_SIZE="20Gi"
export SINGLEUSER_STORAGE_CLASS="microk8s-hostpath"
export HOSTPATH_PROVISIONER_IMAGE="docker.io/cdkbot/hostpath-provisioner:1.5.0"
# GPU / 驅動模式
export USE_GPU_OPERATOR=true
export GPU_DRIVER_MODE="host"
export GPU_OPERATOR_DRIVER_VERSION="580.65.06"
# Adminuser NodePort/port-forward
export EXPOSE_ADMINUSER_NODEPORT=true
export ADMINUSER_TARGET_PORT=8000
export ADMINUSER_NODEPORT=32081
export ADMINUSER_PORTFORWARD=false
export ADMINUSER_PF_PORT=18081
export ADMINUSER_PF_BIND_ADDR="127.0.0.1"

# 啟用 NVIDIA Network Operator 以取得 RDMA/IB 功能
export ENABLE_IB=true
export IB_NIC_POLICY_NAME="nic-cluster-policy"
export IB_NIC_POLICY_TEMPLATE_FILE="<>/templates/nic-cluster-policy.yaml"
# 使用公開 ghcr.io 映像，避免 nvcr.io 需要登入
export IB_RSDP_REPOSITORY="ghcr.io/mellanox"
export IB_RSDP_IMAGE="k8s-rdma-shared-dev-plugin"
export IB_RSDP_VERSION="v1.5.2"
export IB_RSDP_IMAGE_TAR="<>/offline-images/k8s-rdma-shared-dev-plugin-v1.5.2.tar"
export IB_RSDP_CONFIG='{"configList":[{"resourceName":"rdma_shared_device","rdmaHcaMax":63,"selectors":{"vendors":["15b3"]}}]}'
export IB_RESOURCE_NAME="rdma/rdma_shared_device"
export IB_RESOURCE_COUNT=1

# 共享儲存：改用 CephFS 路徑，容器掛載到 /workspace/storage（每用戶子目錄）
export SHARED_STORAGE_ENABLED=true
export SHARED_STORAGE_SIZE=1Ti
export SHARED_STORAGE_PATH="<>/jhub_storage"
